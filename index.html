<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap');
    body { background-color: #f0f2f5; padding: 20px; font-family: 'Sarabun', sans-serif; }
    .card { border-radius: 15px; border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .required::after { content: " *"; color: red; }
    
    /* Loading Overlay ‡πÅ‡∏ö‡∏ö‡∏ß‡∏¥‡∏®‡∏ß‡∏∞ */
    #loadingOverlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255,255,255,0.95); z-index: 9999;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
    }
    .hidden { display: none !important; }
    
    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏õ‡∏∏‡πà‡∏° */
    .btn-primary { background-color: #00B900; border-color: #00B900; } /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß LINE */
    .btn-primary:hover { background-color: #009900; border-color: #009900; }
  </style>
</head>
<body>

  <div id="loadingOverlay">
    <div class="spinner-border text-success" role="status" style="width: 3rem; height: 3rem;"></div>
    <p class="mt-3 text-secondary" id="statusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
  </div>

  <div class="container hidden" id="mainForm">
    <div class="card p-4">
      <div class="text-center mb-4">
        <h4 class="fw-bold text-success">üõ°Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</h4>
        <small class="text-muted">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏≤‡∏†‡∏¥‡πÄ‡∏©‡∏Å</small>
      </div>
      
      <form id="safetyForm">
        <input type="hidden" id="userId">

        <h6 class="text-secondary border-bottom pb-2">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</h6>
        <div class="mb-3">
            <label class="form-label required">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
            <input type="text" class="form-control" id="name" required placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á">
        </div>
        <div class="mb-3">
            <label class="form-label required">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
            <input type="tel" class="form-control" id="phone" required placeholder="0xxxxxxxxx">
        </div>

        <h6 class="text-secondary border-bottom pb-2 mt-4">üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÄ‡∏´‡∏ï‡∏∏</h6>
        <div class="mb-3">
          <label class="form-label required">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</label>
          <select class="form-select" id="building" required onchange="updateFloors()">
            <option value="" selected disabled>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ --</option>
            <option value="‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Ø (‡πÄ‡∏î‡∏¥‡∏°)">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Ø (‡πÄ‡∏î‡∏¥‡∏°)</option>
            <option value="‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Ø (‡πÇ‡∏ã‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ 2)">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Ø (‡πÇ‡∏ã‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ 2)</option>
            <option value="‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏≤‡∏ö‡∏£‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏≤‡∏ö‡∏£‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå</option>
            <option value="‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏≤‡∏õ‡∏±‡∏ô‡∏£‡∏±‡∏Å‡∏©‡πå">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏≤‡∏õ‡∏±‡∏ô‡∏£‡∏±‡∏Å‡∏©‡πå</option>
            <option value="‡∏ï‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ø">‡∏ï‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ø</option>
            <option value="‡∏´‡∏≠‡∏û‡∏±‡∏Å‡∏Ñ‡∏∏‡πâ‡∏°‡∏†‡∏±‡∏¢">‡∏´‡∏≠‡∏û‡∏±‡∏Å‡∏Ñ‡∏∏‡πâ‡∏°‡∏†‡∏±‡∏¢</option>
            <option value="‡∏´‡∏≠‡∏û‡∏±‡∏Å‡∏Å‡∏±‡∏ô‡∏†‡∏±‡∏¢">‡∏´‡∏≠‡∏û‡∏±‡∏Å‡∏Å‡∏±‡∏ô‡∏†‡∏±‡∏¢</option>
            <option value="‡∏ö‡πà‡∏≠‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢">‡∏ö‡πà‡∏≠‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢</option>
            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
          </select>
        </div>
        
        <div class="row">
          <div class="col-6 mb-3">
            <label class="form-label required">‡∏ä‡∏±‡πâ‡∏ô</label>
            <select class="form-select" id="floor" required disabled>
                <option value="">-</option>
            </select>
          </div>
          <div class="col-6 mb-3">
            <label class="form-label required">‡∏´‡πâ‡∏≠‡∏á/‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏ö</label>
            <input type="text" class="form-control" id="room" required placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô">
          </div>
        </div>

        <h6 class="text-secondary border-bottom pb-2 mt-4">‚ö†Ô∏è ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h6>
        <div class="mb-3">
          <label class="form-label required">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</label>
          <select class="form-select" id="category" required>
            <option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
            <option value="‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤">üçÑ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤</option>
            <option value="‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ">‚ò£Ô∏è ‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏•/‡∏Å‡∏•‡∏¥‡πà‡∏ô</option>
            <option value="‡πÑ‡∏ü‡∏ü‡πâ‡∏≤/‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á">‚ö° ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤/‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á</option>
            <option value="‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û/‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á">üèóÔ∏è ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏û‡∏∑‡πâ‡∏ô/‡πÄ‡∏û‡∏î‡∏≤‡∏ô</option>
            <option value="‡∏≠‡∏±‡∏Ñ‡∏Ñ‡∏µ‡∏†‡∏±‡∏¢">üî• ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏≠‡∏±‡∏Ñ‡∏Ñ‡∏µ‡∏†‡∏±‡∏¢</option>
            <option value="‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">üì¢ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ / ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
          </select>
        </div>
        
        <div class="mb-3">
            <label class="form-label required">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
            <textarea class="form-control" id="detail" rows="3" required placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢..."></textarea>
        </div>
        
        <div class="mb-3">
            <label class="form-label">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡∏£‡∏π‡∏õ)</label>
            <input type="file" class="form-control" id="photos" multiple accept="image/*">
            <div id="preview" class="mt-2 d-flex flex-wrap gap-2"></div>
            <small class="text-muted">*‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏¢‡πà‡∏≠‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</small>
        </div>

        <button type="submit" class="btn btn-primary w-100 py-3 shadow fw-bold">üöÄ ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏</button>
      </form>
    </div>
  </div>

  <script>
    // üö®üö® ‡πÉ‡∏™‡πà URL Apps Script ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ (‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢ /exec) üö®üö®
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbyWNYN_WZVBOnmsegtajxRke5uiHbC1lCHU1D2nQSbiDYJp-seE56dHo8VEgpGXS-96ug/exec'; 
    
    // ‡πÉ‡∏™‡πà LIFF ID ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const LIFF_ID = '2008916292-Myi7i6Nl';

    // ----------------------------------------------------

    async function main() {
      try {
        await liff.init({ liffId: LIFF_ID });
        
        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }
        
        const profile = await liff.getProfile();
        document.getElementById('userId').value = profile.userId;
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏ß‡πâ (Name, Phone)
        loadSavedData();
        
        document.getElementById('loadingOverlay').classList.add('hidden');
        document.getElementById('mainForm').classList.remove('hidden');

      } catch (err) { 
        Swal.fire('Error', 'LIFF Init Failed: ' + err, 'error');
      }
    }
    main();

    // ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
    document.getElementById('safetyForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // ‡πÅ‡∏™‡∏î‡∏á Loading
      document.getElementById('loadingOverlay').classList.remove('hidden');
      document.getElementById('statusText').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
      
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå)
      localStorage.setItem('safe_name', document.getElementById('name').value);
      localStorage.setItem('safe_phone', document.getElementById('phone').value);

      // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏á
      const formData = {
        action: 'submit_job', // ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ action ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡∏π‡πâ
        userId: document.getElementById('userId').value,
        reporter: document.getElementById('name').value, // ‡πÅ‡∏°‡∏û‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö DB
        tel: document.getElementById('phone').value,
        building: document.getElementById('building').value,
        floor: document.getElementById('floor').value,
        room: document.getElementById('room').value,
        category: document.getElementById('category').value,
        detail: document.getElementById('detail').value,
        images: processedImages // ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß
      };

      // ‡∏¢‡∏¥‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Script
      fetch(GAS_URL, {
        method: 'POST',
        mode: 'no-cors', 
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      })
      .then(() => {
        // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        Swal.fire({
            icon: 'success',
            title: '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
            text: '‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
            confirmButtonText: '‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á'
        }).then(() => {
            liff.closeWindow();
        });
      })
      .catch(err => {
        document.getElementById('loadingOverlay').classList.add('hidden');
        Swal.fire('Error', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err, 'error');
      });
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏ï‡∏∂‡∏Å (Copy Logic ‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ß‡∏¥‡∏®‡∏ß‡∏∞)
    function updateFloors() {
       const b = document.getElementById('building').value;
       const f = document.getElementById('floor');
       f.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>'; f.disabled = false;
       
       let max = 10; // ‡∏Ñ‡πà‡∏≤ Default
       if (b.includes('‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå') || b.includes('‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏≤‡∏ö‡∏£‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå')) max = 9; // ‡∏™‡∏°‡∏°‡∏ï‡∏¥
       else if (b.includes('‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏≤‡∏õ‡∏±‡∏ô‡∏£‡∏±‡∏Å‡∏©‡πå')) max = 4;
       else if (b.includes('‡∏´‡∏≠‡∏û‡∏±‡∏Å')) max = 5;
       else if (b.includes('‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£')) max = 1;

       for(let i=1; i<=max; i++) f.innerHTML += `<option value="${i}">${i}</option>`;
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ (Image Compression Engine) - ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç!
    let processedImages = [];
    document.getElementById('photos').addEventListener('change', function(e) {
      const files = e.target.files;
      document.getElementById('preview').innerHTML = ''; 
      processedImages = [];
      
      for (let i=0; i<Math.min(files.length, 3); i++) { // ‡∏à‡∏≥‡∏Å‡∏±‡∏î 3 ‡∏£‡∏π‡∏õ
         const reader = new FileReader();
         reader.onload = function(ev) {
            const img = new Image();
            img.onload = function() {
               // ‡∏™‡∏£‡πâ‡∏≤‡∏á Canvas ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠‡∏£‡∏π‡∏õ
               const cvs = document.createElement('canvas'); 
               const ctx = cvs.getContext('2d');
               let w = img.width, h = img.height;
               
               // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 1000px (‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å)
               if(w > 1000){ h *= 1000/w; w = 1000; }
               
               cvs.width = w; cvs.height = h;
               ctx.drawImage(img, 0, 0, w, h);
               
               // ‡πÅ‡∏õ‡∏•‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Base64 ‡πÅ‡∏ö‡∏ö JPEG Quality 0.7 (‡∏ä‡∏±‡∏î‡πÅ‡∏ï‡πà‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏•‡πá‡∏Å)
               const resizedData = cvs.toDataURL('image/jpeg', 0.7);
               
               processedImages.push(resizedData);
               
               // ‡πÅ‡∏™‡∏î‡∏á Preview
               document.getElementById('preview').innerHTML += 
                 `<img src="${resizedData}" class="rounded shadow-sm" style="width:70px;height:70px;object-fit:cover;border:2px solid #fff;">`;
            }
            img.src = ev.target.result;
         }
         reader.readAsDataURL(files[i]);
      }
    });
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥
    function loadSavedData() {
      if(localStorage.getItem('safe_name')) document.getElementById('name').value = localStorage.getItem('safe_name');
      if(localStorage.getItem('safe_phone')) document.getElementById('phone').value = localStorage.getItem('safe_phone');
    }
  </script>
</body>
</html>
